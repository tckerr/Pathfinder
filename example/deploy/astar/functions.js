{function sumVector(e,t){return{x:e["x"]+t["x"],y:e["y"]+t["y"]}}function compareVector2i(e,t){if(e["x"]==t["x"]&&e["y"]==t["y"])return true;return false}function getRelativeLoc(e,t){var n=0;var r=0;switch(t){case"n":r=-1;break;case"ne":n=1;r=-1;break;case"e":n=1;break;case"se":n=1;r=1;break;case"s":r=1;break;case"sw":n=-1;r=1;break;case"w":n=-1;break;case"nw":n=-1;r=-1;break}var i={x:n,y:r};return i}function compareOL(e,t){if(nodes[e].fCost>nodes[t].fCost)return-1;else if(nodes[e].fCost<nodes[t].fCost)return 1;return 0}}{function findPath(){var e=[];var t=[];var n=0;var r=true;var i=false;var s=new pf_Node(set_start,{},set_end,true);nodes.push(s);e.push(nodes[0].id);while(r){if(e.length<1){return false}e.sort(compareOL);n=e[e.length-1];e.splice(e.length-1,1);t.push(n);cParentX=nodes[n].location["x"];cParentY=nodes[n].location["y"];if(cParentX!=set_end["x"]||cParentY!=set_end["y"]){var o=pfc[cParentX][cParentY];for(var u=0;u<o.length;u++){var a=false;var f=false;var l=getRelativeLoc(n,o[u]);var c=sumVector(nodes[n].location,l);for(var h=0;h<e.length;h++){if(compareVector2i(c,nodes[e[h]].location)){a=true;if(nodes[nodes[e[h]].parent].gCost>nodes[n].gCost){nodes[e[h].parent]=n;nodes[e[h]].setGCost();nodes[e[h]].setFCost()}}}if(!a){for(var h=0;h<t.length;h++){if(compareVector2i(c,nodes[t[h]].location)){f=true;break}}}if(!a&&!f){var p=new pf_Node(c,n,set_end,false);nodes.push(p);e.push(p.id)}}}else{r=false}}var d=[];while(!nodes[n].orphan){d.push(n);n=nodes[n].parent}var v=[];for(var u=0;u<d.length;u++){var m=nodes[d[u]].location["x"];var g=nodes[d[u]].location["y"];v.unshift({x:m,y:g});$("#"+m+"_"+g+"").addClass("traversed");labelStep($("#"+m+"_"+g+""),d.length-u)}return d.length}function getAdj(e,t){noN=noS=noW=noE=false;var n,r,i,s,o,u,a,f;y=parseInt(t);x=parseInt(e);if(y<1){n=1;r=1;f=1;noN=true}else if(y>=AREAHEIGHT_PX/BLOCK_SIZE-1){s=1;o=1;u=1;noS=true}if(x<1){f=1;a=1;u=1;noW=true}else if(x>=AREAWIDTH_PX/BLOCK_SIZE-1){r=1;i=1;s=1;noE=true}if(!noN){n=walls[y-1][x];if(!noW){f=walls[y-1][x-1]}if(!noE){r=walls[y-1][x+1]}}if(!noS){o=walls[y+1][x];if(!noW){u=walls[y+1][x-1]}if(!noE){s=walls[y+1][x+1]}}if(!noE){i=walls[y][x+1]}if(!noW){a=walls[y][x-1]}if(n==1&&i==1){r=1}if(n==1&&a==1){f=1}if(o==1&&i==1){s=1}if(o==1&&a==1){u=1}var l=new Array;if(!f){l.push("nw")}if(!n){l.push("n")}if(!r){l.push("ne")}if(!i){l.push("e")}if(!s){l.push("se")}if(!o){l.push("s")}if(!u){l.push("sw")}if(!a){l.push("w")}return l}function getPFConfig(){var e=new Array;for(var t=0;t<AREAWIDTH_BLOCK;t++){e[t]=new Array;for(var n=0;n<AREAHEIGHT_BLOCK;n++){var r=getAdj(t,n);e[t].push(r)}}return e}function spotPF(e,t){var n=parseInt(e);var r=parseInt(t);pfc[n][r]=getAdj(n,r);if(r>0){pfc[n][r-1]=getAdj(n,r-1);if(n<AREAWIDTH_PX/BLOCK_SIZE-1)pfc[n+1][r-1]=getAdj(n+1,r-1);if(n>0)pfc[n-1][r-1]=getAdj(n-1,r-1)}if(r<AREAHEIGHT_PX/BLOCK_SIZE-1){pfc[n][r+1]=getAdj(n,r+1);if(n<AREAWIDTH_PX/BLOCK_SIZE-1)pfc[n+1][r+1]=getAdj(n+1,r+1);if(n>0)pfc[n-1][r+1]=getAdj(n-1,r+1)}if(n>0)pfc[n-1][r]=getAdj(n-1,r);if(n<AREAWIDTH_PX/BLOCK_SIZE-1)pfc[n+1][r]=getAdj(n+1,r)}function getNewPath(){clearPath();pfc=getPFConfig();findPath()}function getNewPathLite(){clearPath();if($(".block-start").length&&$(".block-end").length){var e=false;var t=new StopWatch;t.Start();e=findPath();t.Stop();if(e){logMe("Pathing from ["+set_start["x"]+", "+set_start["y"]+"] to ["+set_end["x"]+", "+set_end["y"]+"] took "+t.ElapsedMilliseconds+"ms and has "+e+" steps.\n")}else{logMe("No path available.\n")}}}}{function appendBlockRow(){var e=document.createElement("tr");e.setAttribute("class","block-row");e.setAttribute("height",BLOCK_SIZE);e.setAttribute("width",AREAWIDTH_PX);$("#playable-area").append(e)}function appendBlock(e,t,n){var r=document.createElement("td");r.setAttribute("class","block");r.setAttribute("height",BLOCK_SIZE);r.setAttribute("width",BLOCK_SIZE);r.setAttribute("id",n+"_"+t);$(e).append(r)}function setStart(e){$(".block-start").removeClass("block-start");e.addClass("block-start");blockid=e.attr("id").split("_");set_start={x:parseInt(blockid[0]),y:parseInt(blockid[1])};changeMenuState(0);$("#flagstart").remove();$("#playable-area").append('<img src="img/flag.png" height="20px" id="flagstart"/>');$("#flagstart").css("top",59+blockid[1]*BLOCK_SIZE);$("#flagstart").css("left",138+blockid[0]*BLOCK_SIZE);logMe("Start point set to ["+blockid[0]+", "+blockid[1]+"].\n");spotPF(blockid[0],blockid[1]);getNewPathLite()}function setEnd(e){$(".block-end").removeClass("block-end");e.addClass("block-end");blockid=e.attr("id").split("_");set_end={x:parseInt(blockid[0]),y:parseInt(blockid[1])};changeMenuState(0);$("#flagend").remove();$("#playable-area").append('<img src="img/flag.png" height="20px" id="flagend"/>');$("#flagend").css("top",59+blockid[1]*BLOCK_SIZE);$("#flagend").css("left",138+blockid[0]*BLOCK_SIZE);spotPF(blockid[0],blockid[1]);logMe("End point set to ["+blockid[0]+", "+blockid[1]+"].\n");getNewPathLite()}function buildWall(e){e.addClass("block-wall");blockid=e.attr("id").split("_");walls[blockid[1]][blockid[0]]=1;spotPF(blockid[0],blockid[1]);getNewPathLite()}function removeWall(e){e.removeClass("block-wall");blockid=e.attr("id").split("_");walls[blockid[1]][blockid[0]]=0;spotPF(blockid[0],blockid[1]);getNewPathLite()}function clearAll(){changeMenuState(0);clearPath();clearWalls();set_start=set_end={};$(".block-start").removeClass("block-start");$(".block-end").removeClass("block-end");$("#flagstart").remove();$("#flagend").remove()}function clearPath(){$(".traversed").removeClass("traversed");$(".steplabel").remove();pfn_incr=0;nodes=[]}function clearWalls(){for(var e=0;e<walls.length;e++){for(var t=0;t<walls[0].length;t++){walls[e][t]=0}}$(".block-wall").removeClass("block-wall");pfc=getPFConfig()}}{function changeMenuState(e){if(e===0||e===menustate){menustate=0;$("#playable-area").css("cursor","auto");$("#menu").children().removeClass("menu-selected")}else{menustate=e;$("#playable-area").css("cursor","crosshair");$(".menu-selected").removeClass("menu-selected");switch(e){case 0:break;case 1:$("#setstart").addClass("menu-selected");break;case 2:$("#setend").addClass("menu-selected");break;case 3:$("#drawwalls").addClass("menu-selected");break}}}function init(){for(var e=0;e<AREAHEIGHT_BLOCK;e++){walls[e]=[];appendBlockRow();var t=$("#playable-area").children("tr").last();for(var n=0;n<AREAWIDTH_BLOCK;n++){walls[e][n]=0;appendBlock(t,e,n)}}$(document).mousedown(function(){mdown=true}).mouseup(function(){mdown=false});pfc=getPFConfig()}function scrollToBottom(e){$("#debug").scrollTop($("#debug")[0].scrollHeight)}function logMe(e){$("#debug").append(e);scrollToBottom()}function labelStep(e,t){e.append('<p class="steplabel">'+t+"</p>")}}{pf_Node.prototype.setFCost=function(){this.fCost=this.hCost+this.gCost};pf_Node.prototype.setHCost=function(e){var t=Math.abs(e["x"]-this.location["x"]);var n=Math.abs(e["y"]-this.location["y"]);this.hCost=10*(t+n)};pf_Node.prototype.setGCost=function(){var e=Math.abs(nodes[this.parent].location["x"]-this.location["x"]);var t=Math.abs(nodes[this.parent].location["y"]-this.location["y"]);if(t!=0&&e!=0)this.gCost=nodes[this.parent].gCost+14;else this.gCost=nodes[this.parent].gCost+10};function pf_Node(e,t,n,r){this.location=e;this.inOpen=false;this.id=pfn_incr;pfn_incr++;if(r){this.parent={};this.orphan=true;this.gCost=0;this.setHCost(n);this.setFCost()}else{this.parent=t;this.orphan=false;this.setGCost();this.setHCost(n);this.setFCost()}}}{StopWatch=function(){this.StartMilliseconds=0;this.ElapsedMilliseconds=0};StopWatch.prototype.Start=function(){this.StartMilliseconds=(new Date).getTime()};StopWatch.prototype.Stop=function(){this.ElapsedMilliseconds=(new Date).getTime()-this.StartMilliseconds}}